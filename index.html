<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>éš¨æ©ŸæŒ‘é¸é¤å»³</title>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px;
        padding: 0;
    }
    h2 { color: #333; text-align: center; }
    input, select {
        padding: 12px;
        margin: 8px 0;
        width: 90%;
        max-width: 400px;
        font-size: 18px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    button {
        padding: 12px 24px;
        margin-top: 15px;
        font-size: 20px;
        width: 90%;
        max-width: 400px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
    button:hover { background-color: #45a049; }
    #loading {
        margin-top: 20px;
        color: #666;
        font-size: 16px;
    }
    #result {
        margin-top: 30px;
        font-size: 22px;
        font-weight: bold;
        color: #e91e63;
        text-align: center;
        min-height: 100px;
    }
    #map { width:0; height:0; }
</style>
</head>
<body>

<h2>å¾æŒ‡å®šå€åŸŸéš¨æ©Ÿé¸ä¸€å®¶é¤å»³</h2>

<input id="locationInput" type="text" placeholder="è¼¸å…¥åœ°é»ï¼Œä¾‹å¦‚ï¼šå°åŒ—å¸‚ ä¿¡ç¾©å€">
<input id="radiusInput" type="number" placeholder="æœå°‹åŠå¾‘ï¼ˆå…¬å°ºï¼Œä¾‹å¦‚ï¼š1500ï¼Œå¯ç•™ç©ºï¼‰">
<input id="keywordInput" type="text" placeholder="é—œéµå­—ï¼ˆä¾‹å¦‚ï¼šå°åƒã€ä¾¿ç•¶ï¼Œå¯ç•™ç©ºï¼‰">

<select id="typeSelect">
    <option value="restaurant">éš¨æ©Ÿé¤å»³</option>
    <option value="cafe">å’–å•¡å»³</option>
    <option value="meal_takeaway">ç†±ç‚’åº—</option>
    <option value="bar">å¿«é¤åº—</option>
    <option value="bakery">é¤å»³</option>
</select>

<button onclick="search()">é–‹å§‹æŠ½é¤å»³</button>

<div id="loading"></div>
<div id="result"></div>
<div id="map"></div>

<script>
let map;

function search() {
    const locationName = document.getElementById("locationInput").value;
    let radius = parseInt(document.getElementById("radiusInput").value);
    const type = document.getElementById("typeSelect").value;
    const keyword = document.getElementById("keywordInput").value.trim();

    if (!locationName) { alert("è«‹è¼¸å…¥åœ°é»ï¼"); return; }
    if (!radius || radius <= 0) radius = 1000;

    document.getElementById("loading").textContent = "æ­£åœ¨å–å¾—åº§æ¨™...";
    document.getElementById("result").textContent = "";

    const geocoder = new google.maps.Geocoder();

    geocoder.geocode({ address: locationName }, function(results, status) {
        if (status !== "OK") {
            document.getElementById("loading").textContent = "åœ°é»ç„¡æ³•å–å¾—åº§æ¨™ï¼š" + status;
            return;
        }

        const location = results[0].geometry.location;
        map = new google.maps.Map(document.getElementById("map"), { center: location, zoom: 15 });

        document.getElementById("loading").textContent = "æ­£åœ¨æœå°‹é¤å»³...";

        const service = new google.maps.places.PlacesService(map);
        let allResults = [];

        // å®šç¾©éè¿´æŠ“å–å¤šé 
        function nearbySearchPage(pageToken = null) {
            const request = { location: location, radius: radius, type: type };
            if (keyword) request.keyword = keyword;
            if (pageToken) request.pageToken = pageToken;

            service.nearbySearch(request, function(results, status, pagination) {
                if (status === "OK" && results.length) {
                    allResults = allResults.concat(results);
                    if (pagination && pagination.hasNextPage) {
                        setTimeout(() => { nearbySearchPage(pagination.nextPage()); }, 2000);
                    } else {
                        // æ‰€æœ‰é é¢æŠ“å®Œå†æŠ½é¸
                        pickRandomRestaurant();
                    }
                } else {
                    if (!allResults.length) {
                        document.getElementById("loading").textContent = "";
                        document.getElementById("result").textContent = "æ‰¾ä¸åˆ°é¤å»³";
                    } else {
                        pickRandomRestaurant();
                    }
                }
            });
        }

        nearbySearchPage();

        function pickRandomRestaurant() {
            document.getElementById("loading").textContent = "";
            const resultDiv = document.getElementById("result");
        
            if (!allResults.length) {
                resultDiv.textContent = "æ‰¾ä¸åˆ°é¤å»³";
                return;
            }
        
            const names = allResults.map(r => r.name);
            let count = 0;
            const maxCount = 20; // é–ƒçˆæ¬¡æ•¸
            const intervalTime = 100;
        
            const interval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * names.length);
                resultDiv.textContent = names[randomIndex];
                count++;
                if (count >= maxCount) {
                    clearInterval(interval);
                    // æœ€çµ‚éš¨æ©Ÿé¸ä¸€å€‹é¤å»³
                    const random = allResults[Math.floor(Math.random() * allResults.length)];
                    resultDiv.innerHTML = `
                        ğŸ‰ ä»Šå¤©åƒï¼š<br><br>
                        <span style="font-size:28px;">${random.name}</span><br><br>
                        â­ è©•åˆ†ï¼š${random.rating || "ç„¡"}<br>
                        ğŸ—ºï¸ åœ°å€ï¼š${random.vicinity || "ç„¡è³‡æ–™"}<br><br>
                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(random.name)}" target="_blank">
                            æ‰“é–‹ Google åœ°åœ–
                        </a>
                    `;
                }
            }, intervalTime);
        }
    });
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA3pTso7fz7uUkB4jvie9X3hy__fSmYwLw&libraries=places"></script>

</body>
</html>


